"use strict";(self.webpackChunkdocassemble_assembly_line_documentation=self.webpackChunkdocassemble_assembly_line_documentation||[]).push([[3794],{4137:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>f});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=r.createContext({}),s=function(e){var t=r.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=s(e.components);return r.createElement(p.Provider,{value:t},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,p=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=s(n),m=a,f=d["".concat(p,".").concat(m)]||d[m]||c[m]||o;return n?r.createElement(f,i(i({ref:t},u),{},{components:n})):r.createElement(f,i({ref:t},u))}));function f(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=m;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l[d]="string"==typeof e?e:a,i[1]=l;for(var s=2;s<o;s++)i[s]=n[s];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},7979:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>s});var r=n(7462),a=(n(7294),n(4137));const o={sidebar_label:"docx_wrangling",title:"formfyxer.docx_wrangling"},i=void 0,l={unversionedId:"reference/formfyxer/docx_wrangling",id:"reference/formfyxer/docx_wrangling",title:"formfyxer.docx_wrangling",description:"update\\_docx",source:"@site/docs/reference/formfyxer/docx_wrangling.md",sourceDirName:"reference/formfyxer",slug:"/reference/formfyxer/docx_wrangling",permalink:"/docassemble-AssemblyLine-documentation/docs/reference/formfyxer/docx_wrangling",draft:!1,editUrl:"https://github.com/SuffolkLITLab/docassemble-AssemblyLine-documentation/edit/main/docs/reference/formfyxer/docx_wrangling.md",tags:[],version:"current",frontMatter:{sidebar_label:"docx_wrangling",title:"formfyxer.docx_wrangling"},sidebar:"api",previous:{title:"py_efsp_client",permalink:"/docassemble-AssemblyLine-documentation/docs/reference/EFSPIntegration/py_efsp_client"},next:{title:"lit_explorer",permalink:"/docassemble-AssemblyLine-documentation/docs/reference/formfyxer/lit_explorer"}},p={},s=[{value:"update_docx",id:"update_docx",level:4},{value:"get_docx_repr",id:"get_docx_repr",level:4},{value:"get_labeled_docx_runs",id:"get_labeled_docx_runs",level:4},{value:"get_modified_docx_runs",id:"get_modified_docx_runs",level:4},{value:"make_docx_plain_language",id:"make_docx_plain_language",level:4},{value:"modify_docx_with_openai_guesses",id:"modify_docx_with_openai_guesses",level:4}],u={toc:s};function d(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h4",{id:"update_docx"},"update","_","docx"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"def update_docx(\n        document: Union[docx.Document, str],\n        modified_runs: List[Tuple[int, int, str, int]]) -> docx.Document\n")),(0,a.kt)("p",null,"Update the document with the modified runs."),(0,a.kt)("p",null,"Note: OpenAI is probabilistic, so the modified run indices may not be correct.\nWhen the index of a run or paragraph is out of range, a new paragraph\nwill be inserted at the end of the document or a new run at the end of the\nparagraph","'","s runs."),(0,a.kt)("p",null,"Take a careful look at the output document to make sure it is still correct."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"document")," - the docx.Document object, or the path to the DOCX file"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"modified_runs")," - a tuple of paragraph number, run number, the modified text, a question (not used), and whether a new paragraph should be inserted (for conditional text)")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Returns"),":"),(0,a.kt)("p",null,"  The modified document."),(0,a.kt)("h4",{id:"get_docx_repr"},"get","_","docx","_","repr"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"def get_docx_repr(docx_path: str,\n                  paragraph_start: int = 0,\n                  paragraph_end: Optional[int] = None)\n")),(0,a.kt)("p",null,"Return a JSON representation of the paragraphs and runs in the DOCX file."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"docx_path")," - path to the DOCX file")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Returns"),":"),(0,a.kt)("p",null,"  A JSON representation of the paragraphs and runs in the DOCX file."),(0,a.kt)("h4",{id:"get_labeled_docx_runs"},"get","_","labeled","_","docx","_","runs"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"def get_labeled_docx_runs(\n        docx_path: Optional[str] = None,\n        docx_repr=Optional[str],\n        custom_people_names: Optional[Tuple[str, str]] = None,\n        openai_client: Optional[OpenAI] = None,\n        api_key: Optional[str] = None) -> List[Tuple[int, int, str, int]]\n")),(0,a.kt)("p",null,"Scan the DOCX and return a list of modified text with Jinja2 variable names inserted."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"docx_path")," - path to the DOCX file"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"docx_repr")," - a string representation of the paragraphs and runs in the DOCX file, if docx_path is not provided. This might be useful if you want"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"custom_people_names")," - a tuple of custom names and descriptions to use in addition to the default ones. Like: (",'"',"clients",'"',", ",'"',"the person benefiting from the form",'"',")")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Returns"),":"),(0,a.kt)("p",null,"  A list of tuples, each containing a paragraph number, run number, and the modified text of the run."),(0,a.kt)("h4",{id:"get_modified_docx_runs"},"get","_","modified","_","docx","_","runs"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},'def get_modified_docx_runs(docx_path: Optional[str] = None,\n                           docx_repr: Optional[str] = None,\n                           custom_example: str = "",\n                           instructions: str = "",\n                           openai_client: Optional[OpenAI] = None,\n                           api_key: Optional[str] = None,\n                           temperature=0.5) -> List[Tuple[int, int, str, int]]\n')),(0,a.kt)("p",null,"Use GPT to rewrite the contents of a DOCX file paragraph by paragraph. Does not handle tables, footers, or\nother structures yet."),(0,a.kt)("p",null,"This is a light wrapper that provides the structure of DOCX paragraphs and runs to your prompt\nto OpenAI to facilitate the rewriting of the document without disrupting formatting."),(0,a.kt)("p",null,"For example, this could be used to:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Remove any passive voice"),(0,a.kt)("li",{parentName:"ul"},"Replace placeholder text with variable names"),(0,a.kt)("li",{parentName:"ul"},"Rewrite to a 6th grade reading level"),(0,a.kt)("li",{parentName:"ul"},"Do an advanced search and replace, without requiring you to use a regex")),(0,a.kt)("p",null,"By default, the example prompt includes a sample like this:"),(0,a.kt)("p",null,"[\n","[0, 0, ",'"',"Dear ",'"]',",\n","[0, 1, ",'"',"John Smith:",'"]',",\n","[1, 0, ",'"',"I hope this letter finds you well.",'"]',",\n]"),(0,a.kt)("p",null,"Your custom instructions should include an example of how the sample will be modified, like the one below:"),(0,a.kt)("p",null,"Example reply, indicating paragraph, run, the new text, and a number indicating if this changes the\ncurrent paragraph, adds one before, or adds one after (-1, 0, 1):"),(0,a.kt)("p",null,"{",'"',"results",'"',":\n[\n[0, 1, ",'"',"Dear {{ other_parties","[0]"," }}:",'"',", 0],\n","[2, 0, ",'"',"{%p if is_tenant %}",'"',", -1]",",\n","[3, 0, ",'"',"{%p endif %}",'"',", 1]",",\n]\n}"),(0,a.kt)("p",null,"You may also want to customize the input example to better match your use case."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"docx_path")," ",(0,a.kt)("em",{parentName:"li"},"str")," - path to the DOCX file"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"docx_repr")," ",(0,a.kt)("em",{parentName:"li"},"str")," - a string representation of the paragraphs and runs in the DOCX file, if docx_path is not provided."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"custom_example")," ",(0,a.kt)("em",{parentName:"li"},"Optional","[str]")," - a string containing the purpose and overview of the task\ninstructions (str) a string containing specific instructions for the task"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"openai_client")," ",(0,a.kt)("em",{parentName:"li"},"Optional","[OpenAI]")," - an OpenAI client object. If not provided a new one will be created."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"api_key")," ",(0,a.kt)("em",{parentName:"li"},"Optional","[str]")," - an OpenAI API key. If not provided, it will be obtained from the environment"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"temperature")," ",(0,a.kt)("em",{parentName:"li"},"float")," - the temperature to use when generating text. Lower temperatures are more conservative.")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Returns"),":"),(0,a.kt)("p",null,"  A list of tuples, each containing a paragraph number, run number, and the modified text of the run."),(0,a.kt)("h4",{id:"make_docx_plain_language"},"make","_","docx","_","plain","_","language"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"def make_docx_plain_language(docx_path: str) -> docx.Document\n")),(0,a.kt)("p",null,"Convert a DOCX file to plain language with the help of OpenAI."),(0,a.kt)("h4",{id:"modify_docx_with_openai_guesses"},"modify","_","docx","_","with","_","openai","_","guesses"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"def modify_docx_with_openai_guesses(docx_path: str) -> docx.Document\n")),(0,a.kt)("p",null,"Uses OpenAI to guess the variable names for a document and then modifies the document with the guesses."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Arguments"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"docx_path")," ",(0,a.kt)("em",{parentName:"li"},"str")," - Path to the DOCX file to modify.")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Returns"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"docx.Document")," - The modified document, ready to be saved to the same or a new path")))}d.isMDXComponent=!0}}]);